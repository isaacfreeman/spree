<% stock_items = variant.stock_items.sort_by{|i| i.stock_location.name} %>
<tbody id="<%= spree_dom_id variant %>" <%= 'style="color:red;"' if variant.deleted? %> data-hook="variants_row" class="variant <%= cycle('odd', 'even')%>">
  <%= f.fields_for :variants, variant do |vf| %>
    <tr class="show">
      <td class="handle no-border">
        <span class="handle"></span>
        <%= vf.hidden_field :position, :value => variant.position, :class => 'position_field' %>
      </td>
      <td id="show_product_variants_attributes_<%= variant_counter %>_sku" class="sku field-display">
        <div data-hook="admin_product_form_sku">
          <%= variant.sku %>
        </div>
        <div data-hook="admin_product_form_shipping_specs">
          Weight:
          <span id="show_product_variants_attributes_<%= variant_counter %>_weight" class="field-display">
            <%= number_with_precision(variant.weight, :precision => 2) %>
          </span>
          &nbsp;
          <span id="show_product_variants_attributes_<%= variant_counter %>_height" class="field-display">
            <%= number_with_precision(variant.height, :precision => 2) %>
          </span>h
          &times;
          <span id="show_product_variants_attributes_<%= variant_counter %>_width" class="field-display">
            <%= number_with_precision(variant.width, :precision => 2) %>
          </span>w
          &times;
          <span id="show_product_variants_attributes_<%= variant_counter %>_depth" class="field-display">
            <%= number_with_precision(variant.depth, :precision => 2) %>
          </span>d
        </div>
        <ul class="images">
          <% variant.images.each do |image| %>
            <li class="image">
              <%= link_to image_tag(image.attachment.url(:mini)), image.attachment.url(:product) %>
            </li>
          <% end %>
        </ul>
      </td>
      <% @product.option_types.each do |option_type| %>
        <td id="show_variant_<%= variant_counter %>_option_<%= option_type.name %>" class="option_value field-display"><%= variant.option_value(option_type.name) %></td>
      <% end %>
      <td id="show_product_variants_attributes_<%= variant_counter %>_price" class="price field-display">
        <%= variant.display_price.to_html %>
      </td>
      <td class="stock">
        <% if variant.track_inventory? && stock_items.any? %>
          <table class="variant_stock_table" style="<%= 'display: none;' unless variant.track_inventory %>">
            <% stock_items.each do |stock_item| %>
              <% if stock_item.count_on_hand > 0 || stock_item.backorderable %>
                <%= render partial: 'spree/admin/stock_items/stock_item_show', locals: {stock_item: stock_item} %>
              <% end %>
            <% end %>
          </table>
        <% else %>
          <span id="show_product_variants_attributes_<%= variant_counter %>_track_inventory" class="field-display">
            Not tracking inventory
          </span>
        <% end %>
      </td>
      <td class="actions">
        <% unless variant.deleted? %>
          <%= link_to_with_icon('edit',
                                Spree.t(:edit),
                                variant.new_record? ? '#' : edit_admin_product_variant_url(@product, variant),
                                :no_text => true,
                                :data => {:action => 'edit'}
                               ) %>
          <%= link_to_with_icon('trash',
                                Spree.t(:delete),
                                admin_product_variant_url(@product, variant),
                                :no_text => true,
                                :class => "delete-variant"
                               ) unless variant.deleted? || variant.new_record? %>
          <%= vf.check_box '_destroy', :value => false, :class => 'destroy_marker', :style => 'display: none;' %>
        <% end %>
      </td>
    </tr>

    <tr class="edit" style="display: none;">
      <td>
      </td>
      <td class="sku">
        <%= render :partial => 'spree/shared/error_messages', :locals => { :target => variant } %>
        <div class="field" data-hook="sku">
          <%= vf.label :sku, Spree.t(:sku) %>
          <%= vf.text_field :sku, :class => 'fullwidth edit_field' %>
        </div>
        <div data-hook="admin_product_form_shipping_specs">
          <ul>
            <div class="shipping_specs_weight_field field alpha two columns" data-hook="admin_product_form_weight">
              <%= f.label :weight, Spree.t(:weight) %>
              <%= f.text_field :weight, :size => 4 %>
            </div>
            <li class="shipping_specs_height_field field one columns" data-hook="admin_product_form_height">
              <%= f.label :height, Spree.t(:height) %>
              <%= f.text_field :height, :size => 4 %>
            </li>
            <li class="shipping_specs_width_field field one columns" data-hook="admin_product_form_width">
              <%= f.label :width, Spree.t(:width) %>
              <%= f.text_field :width, :size => 4 %>
            </li>
            <li class="shipping_specs_depth_field field omega one columns" data-hook="admin_product_form_depth">
              <%= f.label :depth, Spree.t(:depth) %>
              <%= f.text_field :depth, :size => 4 %>
            </li>
          </ul>
        </div>


      </td>
      <% @product.option_types.each do |option_type| %>
        <td class="option_value">
          <div id="variant_<%= variant_counter %>_option_<%= option_type.name %>" class="field field-option_value" data-hook="presentation">
            <%= label :new_variant, option_type.presentation %>
            <%= vf.collection_select 'option_value_ids', option_type.option_values, :id, :presentation,
              { :prompt => true }, { :name => "product[variants_attributes][#{vf.index}][option_value_ids][]", :class => 'select2 fullwidth edit_field' } %>
          </div>
        </td>
      <% end %>
      <td>
        <div class="field" data-hook="price">
          <%= vf.label :price, Spree.t(:price) %>
          <%= vf.text_field :price, :value => number_to_currency(variant.price, :unit => ''), :class => 'fullwidth edit_field' %>
        </div>

        <div class="field" data-hook="cost_price">
          <%= vf.label :cost_price, Spree.t(:cost_price) %>
          <%= vf.text_field :cost_price, :value => number_to_currency(variant.cost_price, :unit => ''), :class => 'fullwidth' %>
        </div>

        <div class="field" data-hook="tax_category">
          <%= vf.label :tax_category_id, Spree.t(:tax_category) %>
          <%= vf.collection_select(:tax_category_id, @tax_categories, :id, :name, { :include_blank => Spree.t('match_choices.none') }, { :class => 'select2 fullwidth' }) %>
        </div>
      </td>
      <td class="stock">
        <div data-hook="track_inventory" class="field checkbox">
          <label>
            <%= vf.check_box :track_inventory, class: 'track_inventory' %>
            <%= Spree.t(:track_inventory) %>
          </label>
        </div>
        <table class="variant_stock_table" style="<%= 'display: none;' unless variant.track_inventory %>">
          <% stock_items.each do |stock_item| %>
            <%= render partial: 'spree/admin/stock_items/stock_item_edit', locals: {stock_item: stock_item, f: vf} %>
          <% end %>
        </table>
      </td>
      <td class="actions">
        <div class="form-buttons filter-actions actions" data-hook="buttons">
          <%= link_to_with_icon('ok',
                                Spree.t('actions.continue'),
                                '#',
                                :no_text => true,
                                :'data-target' => spree_dom_id(variant)
                               ) %>
        </div>
      </td>
    </tr>
  <% end %>

</tbody>
