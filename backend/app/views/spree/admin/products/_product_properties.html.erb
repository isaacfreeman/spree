<ul class="toolbar inline-menu" data-hook="toolbar-product-properties">
  <li>
    <%= link_to_add_fields Spree.t(:add_product_properties), 'tbody#product_properties', :class => 'plus button add_product_property_fields' %>
  </li>
  <li>
    <span id="new_ptype_link">
      <%= link_to Spree.t(:select_from_prototype), available_admin_prototypes_url, :remote => true, 'data-update' => 'prototypes', :class => 'button fa fa-copy' %>
    </span>
  </li>
</ul>

<div class="add_product_properties" data-hook="add_product_properties"></div>

<div id="prototypes" data-hook></div>
<%= image_tag 'select2-spinner.gif', :plugin => 'spree', :style => 'display:none;', :id => 'busy_indicator' %>

<table class="index sortable" data-hook data-sortable-link="<%#= update_positions_admin_product_product_properties_url %>">
  <thead>
    <tr data-hook="product_properties_header">
      <th colspan="2"><%= Spree.t(:property) %></th>
      <th><%= Spree.t(:value) %></th>
      <th class="actions"></th>
    </tr>
  </thead>
  <tbody id="product_properties" data-hook>
    <%= f.fields_for :product_properties do |pp_form| %>
      <% if @product.properties.any? %>
        <%= render 'spree/admin/product_properties/product_property_fields', :f => pp_form %>
      <% else %>
        <tr class="no-objects-found">
          <td colspan="<%= @product.option_types.count + 4 %>">
            <%= Spree.t(:no_resource_found, resource: I18n.t(:other, scope: 'activerecord.models.spree/properties')) %>,

            <%= link_to_add_fields Spree.t(:add_one), 'tbody#product_properties', :class => 'add_product_property_fields' %>
          </td>
        </tr>
      <% end %>

    <% end %>
  </tbody>
</table>

<%= javascript_tag do -%>
  var properties = <%= raw(@properties.to_json) %>;
  $('#product_properties').on('keydown', 'input.autocomplete', function() {
    already_auto_completed = $(this).is('ac_input');
    if (!already_auto_completed) {
      $(this).autocomplete({source: properties}).focus();
    }
  });
<% end -%>
