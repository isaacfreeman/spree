<ul class="toolbar inline-menu" data-hook="toolbar-product-properties">
  <li id="new_image_link" data-hook>
    <%= link_to_with_icon(
      'plus',
      Spree.t(:add_product_properties),
      new_admin_product_product_property_path(@product),
      remote: true,
      :data => {
        :target => "#product_properties",
        :itemTag => 'tr'
      },
      :class => "plus button spree_add_product_property")
    %>
  </li>
  <li>
    <span id="new_ptype_link">
      <%= link_to Spree.t(:select_from_prototype), available_admin_prototypes_url, :remote => true, 'data-update' => 'prototypes', :class => 'button fa fa-copy' %>
    </span>
  </li>
</ul>

<div id="prototypes" data-hook></div>
<%= image_tag 'select2-spinner.gif', :plugin => 'spree', :style => 'display:none;', :id => 'busy_indicator' %>

<table class="index sortable-product_properties" data-hook data-sortable-link="<%#= update_positions_admin_product_product_properties_url %>">
  <thead>
    <tr data-hook="product_properties_header">
      <th colspan="2"><%= Spree.t(:property) %></th>
      <th><%= Spree.t(:value) %></th>
      <th class="actions"></th>
    </tr>
  </thead>
  <tbody id="product_properties" data-hook>
    <% if @product.product_properties.any? %>
      <% @product.product_properties.each_with_index do |product_property, i| %>
        <%= render partial: 'spree/admin/product_properties/product_property', locals: {f: f, product_property: product_property, product: @product, product_property_counter: i} %>
      <% end %>
    <% else %>
      <tr class="no-objects-found">
        <td colspan="3">
          <%= Spree.t(:no_resource_found, resource: I18n.t(:other, scope: 'activerecord.models.spree/property')) %>,

          <%= link_to(
            Spree.t(:add_one),
            new_admin_product_product_property_path(@product),
            remote: true,
            :data => {
              :target => "#product_properties",
              :itemTag => 'tr'
            },
            :class => "spree_add_product_property")
          %>!
        </td>
      </tr>

    <% end %>
  </tbody>
</table>

<%= javascript_tag do -%>
  var properties = <%= raw(@properties.to_json) %>;
  $('#product_properties').on('keydown', 'input.autocomplete', function() {
    already_auto_completed = $(this).is('ac_input');
    if (!already_auto_completed) {
      $(this).autocomplete({source: properties}).focus();
    }
  });
<% end -%>
